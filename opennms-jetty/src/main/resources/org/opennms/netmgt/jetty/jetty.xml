<?xml version="1.0"?>
<!DOCTYPE Configure PUBLIC "-//Jetty//Configure//EN" "http://www.eclipse.org/jetty/configure.dtd">

<Configure id="Server" class="org.eclipse.jetty.server.Server">

  <New id="httpConfig" class="org.eclipse.jetty.server.HttpConfiguration">
     <Set name="requestHeaderSize"><SystemProperty name="org.opennms.netmgt.jetty.requestHeaderSize" default="4000" /></Set>
  </New>

  <Call name="addConnector">
    <Arg>
      <New id="httpConnector" class="org.eclipse.jetty.server.ServerConnector">
        <Arg name="server"><Ref refid="Server" /></Arg>
        <Arg name="factories">
          <Array type="org.eclipse.jetty.server.ConnectionFactory">
            <Item>
              <New class="org.eclipse.jetty.server.HttpConnectionFactory">
                <Arg name="config"><Ref refid="httpConfig" /></Arg>
                <Arg name="compliance"><Call class="org.eclipse.jetty.http.HttpCompliance" name="valueOf"><Arg><Property name="jetty.http.compliance" default="RFC7230"/></Arg></Call></Arg>
              </New>
            </Item>
          </Array>
        </Arg>
        <Set name="host"><SystemProperty name="org.opennms.netmgt.jetty.host" default="0.0.0.0" /></Set>
        <Set name="port"><SystemProperty name="org.opennms.netmgt.jetty.port" default="8980" /></Set>
      </New>
    </Arg>
  </Call>

  <!-- Enable stats -->
  <Call name="insertHandler">
    <Arg>
      <New id="StatsHandler" class="org.eclipse.jetty.server.handler.StatisticsHandler">
      </New>
    </Arg>
  </Call>
  <Call class="org.eclipse.jetty.server.ConnectorStatistics" name="addToAllConnectors">
    <Arg><Ref refid="Server"/></Arg>
  </Call>

    <Set name="handler">
        <New id="Handlers" class="org.eclipse.jetty.server.handler.HandlerCollection">
            <Set name="handlers">
             <Array type="org.eclipse.jetty.server.Handler">
               <!-- Note #2 Uncomment to set X-Frame-Options with #1 above  -->
               <!-- 
                 <Item>
                     <Ref id="RewriteHandler"/>
                 </Item>
               -->
                 <Item>
                     <New id="Contexts" class="org.eclipse.jetty.server.handler.ContextHandlerCollection"/>
                 </Item>
                 <Item>
                     <New id="DefaultHandler" class="org.eclipse.jetty.server.handler.DefaultHandler"/>
                 </Item>
             </Array>
            </Set>
        </New>
    </Set>

    <New id="DeploymentManager" class="org.eclipse.jetty.deploy.DeploymentManager">
        <Set name="contexts">
            <Ref id="Contexts" />
        </Set>
        <Call name="setContextAttribute">
            <Arg>org.eclipse.jetty.server.webapp.ContainerIncludeJarPattern</Arg>
            <Arg>.*/[^/]*\.jar$</Arg>
        </Call>
        <Call name="addAppProvider">
            <Arg>
                <New class="org.opennms.netmgt.jetty.MyWebAppProvider">
                    <Set name="monitoredDirName"><SystemProperty name="opennms.home" />/jetty-webapps</Set>
                    <Set name="scanInterval">10</Set>
                    <Set name="extractWars">false</Set>
                </New>
            </Arg>
        </Call>
    </New>

    <Call name="addBean">
        <Arg>
            <Ref refid="DeploymentManager"/>
        </Arg>
    </Call>

</Configure>